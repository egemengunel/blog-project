import{f as F,l as o,g as $,c as m,a as t,j as u,t as A,F as D,m as h,v as x,n as w,p as E,o as v}from"./BKCbIHqA.js";import"@prisma/client";const T={class:"absolute top-0 z-0 w-full bg-slate-200 overflow-hidden py-16"},j={class:"max-w-screen-xl mx-auto px-8"},P={class:"flex items-center justify-between"},S=["disabled"],B={for:"cover",class:"w-full aspect-[5/2] max-h-80 rounded-3xl bg-slate-800 flex flex-col items-center justify-center text-white cursor-pointer relative overflow-hidden"},M=["src"],N={class:"w-full h-32 bg-slate-400 rounded-3xl overflow-hidden mt-8"},z={class:"w-full h-64 bg-slate-600 rounded-3xl overflow-hidden mt-8"},I=F({__name:"create",setup(R){const s=o(null),{$trpcClient:y,$supabase:b}=$(),a=o(!1),n=o(""),r=o(""),d=o(null),_=o(null),k=o(null),C=i=>{var c;const l=(c=i.target.files)==null?void 0:c[0];if(l){s.value=l;const f=new FileReader;f.onload=p=>{var g;d.value=(g=p.target)==null?void 0:g.result},f.readAsDataURL(l)}else s.value=null,d.value=null},U=async()=>{if(a.value||!n.value||!r.value){alert("Please fill the title and the content"),a.value=!1;return}a.value=!0;let i=null;if(s.value)try{const e=s.value.name.split(".").pop(),c=`public/${`${Date.now()}-${Math.random().toString(36).substring(2,8)}.${e}`}`,{data:f,error:p}=await b.storage.from("blog-images").upload(c,s.value,{cacheControl:"3600",upsert:!1});if(p)throw p;const{data:g}=b.storage.from("blog-images").getPublicUrl(f.path);i=g.publicUrl,console.log("Image uploaded to Supabase Storage at:",i)}catch(e){console.error("failed to upload image to supabse storage",e);const l=(e==null?void 0:e.message)||"Unknown error during img upload";alert(`Failed to upload image ${l}`),a.value=!1;return}try{await y.post.create.mutate({content:n.value,imgUrl:i,title:r.value}),n.value="",r.value="",d.value=null,s.value=null,alert("Blog Post Added"),E("/")}catch(e){console.error("Failed to create post:",e);const l=(e==null?void 0:e.message)||"Unknown error during post creation.";alert(`Failed to create post: ${l}`)}finally{a.value=!1}};return(i,e)=>(v(),m("div",null,[t("section",T,[t("div",j,[t("div",P,[e[2]||(e[2]=t("h1",{class:"text-black text-3xl font-bold mb-8 pt-8"},"Add an Entry",-1)),t("button",{disabled:u(a),class:"w-44 h-14 rounded-full bg-slate-500 text-white text-xl font-medium hover:bg-slate-600 disabled:opacity-50 disabled:cursor-not-allowed",onClick:U},A(u(a)?"Posting":"Add"),9,S)]),t("label",B,[u(d)?(v(),m("img",{key:0,src:u(d),alt:"preview",class:"object-cover w-full h-full"},null,8,M)):(v(),m(D,{key:1},[e[3]||(e[3]=t("div",{class:"w-20 h-20 border-4 border-white rounded-full flex items-center justify-center text-4xl mb-4"}," + ",-1)),e[4]||(e[4]=t("p",{class:"text-center px-6"},"Add an image for your entry",-1))],64)),t("input",{id:"cover",type:"file",accept:"image/*",class:"hidden",onChange:C},null,32)]),t("div",N,[h(t("textarea",{ref_key:"titleContent",ref:k,"onUpdate:modelValue":e[0]||(e[0]=l=>w(r)?r.value=l:null),class:"w-full h-full p-2 bg-transparent text=white placeholder-gray-600 focus:outline-none resize-none",placeholder:"Enter Title"},null,512),[[x,u(r)]])]),t("div",z,[h(t("textarea",{ref_key:"blogContent",ref:_,"onUpdate:modelValue":e[1]||(e[1]=l=>w(n)?n.value=l:null),class:"w-full h-full p-4 bg-transparent text-white placeholder-gray-400 focus:outline-none resize-none",placeholder:"Enter Your Text Here"},null,512),[[x,u(n)]])])])])]))}});export{I as default};
